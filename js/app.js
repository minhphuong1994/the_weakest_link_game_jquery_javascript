let Questionnaire = [
    {
        "question": "Which of these two names typically refer to a female rabbit?",
        "right": "Doe/Jill",
        "wrong1": "Angeline/Sow",
        "wrong2": "Angeline/Sow",
        "wrong3": "Worker/Bitch",
    },
    {
        "question": "Rock group Queen sang the soundtrack to which 1980 sci-fi movie?",
        "right": "Flash Gordon",
        "wrong1": "Death Watch",
        "wrong2": "The Empire Strikes Back",
        "wrong3": "Galaxina",
    },
    {
        "question": "What does the Latin phrase 'terra firma' mean?",
        "right": "Dry Land",
        "wrong1": "Our planet",
        "wrong2": "Horizon",
        "wrong3": "Island",
    },
    {
        "question": "In which Shakespeare play would you find the line 'The quality of mercy is not strain'd'?",
        "right": "The Merchant of Venice",
        "wrong1": "Othello",
        "wrong2": "A midsummer Night s Dream",
        "wrong3": "The Taming of the Shrew",
    },
    {
        "question": "Which Is The Nearest Star To The Earth?",
        "right": "Sun",
        "wrong1": "Moon",
        "wrong2": "Proxima Centauri",
        "wrong3": "Alpha Centauri",
    },
    {
        "question": "Which Ivy League school is located on the Upper West Side of Manhattan?",
        "right": "Columbia",
        "wrong1": "Brown",
        "wrong2": "Yale",
        "wrong3": "Cornell",
    },
    {
        "question": "Mount Everest is located in which country?",
        "right": "Nepal",
        "wrong1": "China",
        "wrong2": "India",
        "wrong3": "Kazakhstan",
    },
    {
        "question": "Which was the last state to join the USA?",
        "right": "Hawaii",
        "wrong1": "New Maxico",
        "wrong2": "Delaware",
        "wrong3": "Alaska",
    },
    {
        "question": "In the human body, insulin and adrenaline are types of what?",
        "right": "Hormone",
        "wrong1": "Blood cell",
        "wrong2": "Stimulant",
        "wrong3": "Placebo",
    },
    {
        "question": "Who became manager of Manchester United in 1986?",
        "right": "Alex Ferguson",
        "wrong1": "Ron Atkinson",
        "wrong2": "Matt Busby",
        "wrong3": "Mark Hughes",
    },
    {
        "question": "In the bible, who was the father of Cain and Abel?",
        "right": "Adam",
        "wrong1": "Abraham",
        "wrong2": "Isaac",
        "wrong3": "Joseph",
    },
    {
        "question": "According To The Saying, Actions Speak Louder Than What?",
        "right": "Words",
        "wrong1": "Reactions",
        "wrong2": "Sentenses",
        "wrong3": "Numbers",
    },
    {
        "question": "In Math, Which Numbering System Is In Common Use?",
        "right": "Base 10",
        "wrong1": "Base 8",
        "wrong2": "Base 2",
        "wrong3": "Base 16",
    },
    {
        "question": "In Math, What Is The Term For A Step-By-Step Problem-Solving Procedure?",
        "right": "Algorithm",
        "wrong1": "Program",
        "wrong2": "Flow Chart",
        "wrong3": "Theorems",
    },
    {
        "question": "In The Classic Children's Story, What Type Of Animal Was Babe?",
        "right": "Pig",
        "wrong1": "Dog",
        "wrong2": "Cat",
        "wrong3": "Mouse",
    },
    {
        "question": "How Many Stomachs Does A Cow Have?",
        "right": "4",
        "wrong1": "3",
        "wrong2": "2",
        "wrong3": "1",
    },
    {
        "question": "What Is The Average Time Taken By The Moon To Orbit The Earth?",
        "right": "27.3 Days",
        "wrong1": "1 Month",
        "wrong2": "28.5 Days",
        "wrong3": "25.9 Days",
    },
    {
        "question": "Orange Juice Is A Good Source Of Which Vitamin?",
        "right": "Vitamin C",
        "wrong1": "Vitamin A",
        "wrong2": "Vitamin E",
        "wrong3": "Vitamin B",
    },
    {
        "question": " Which Part Of The Body Contains The Most Bones? ",
        "right": "Ear",
        "wrong1": "Head",
        "wrong2": "Feet",
        "wrong3": "Arm",
    },
    {
        "question": " Which Animal's Milk Will Never Curdle? ",
        "right": "Camel",
        "wrong1": "Goat",
        "wrong2": "Sheep",
        "wrong3": "Cat",
    },
    {
        "question": "What Was The Only Sport Played On The Moon?",
        "right": "Golf",
        "wrong1": "Table Tennis",
        "wrong2": "Ludo",
        "wrong3": "Football",
    },
    {
        "question": "How Can You Start Your Day With A Faster-Burning Metabolism?",
        "right": "Run for 10 minutes",
        "wrong1": "Drink energy drinks",
        "wrong2": "Yoga",
        "wrong3": "Exercise in gym",
    },
    {
        "question": "Dover Is A City In What Country?",
        "right": "England",
        "wrong1": "United states",
        "wrong2": "China",
        "wrong3": "Canada",
    },
    {
        "question": "Which of the following animal products is a primary ingredient in the drink mead?",
        "right": "Honey",
        "wrong1": "Eggs",
        "wrong2": "Milk",
        "wrong3": "Bone Char",
    },
    {
        "question": "In an English trial, how many people sit on the jury?",
        "right": "12",
        "wrong1": "8",
        "wrong2": "15",
        "wrong3": "10",
    },
    {
        "question": "In which huge Asian country was their all-time one-month film box office record set in 2019?",
        "right": "China",
        "wrong1": "India",
        "wrong2": "United States",
        "wrong3": "United Kingdom",
    },
    {
        "question": "Steve Eastbrook was fired as the CEO of which global fast-food chain after admitting to an affair with a staff member?",
        "right": "McDonald's",
        "wrong1": "Pizza Hut",
        "wrong2": "Burger King",
        "wrong3": "Domino's Pizza",
    },
    {
        "question": "In the Herman Melville novel, What color is Moby Dick?",
        "right": "White",
        "wrong1": "Black",
        "wrong2": "Grey",
        "wrong3": "Blue",
    },
    {
        "question": "In geography, what is the capital of Missouri?",
        "right": "Jefferson City",
        "wrong1": "Branson",
        "wrong2": "Joplin",
        "wrong3": "St. Louis",
    },
    {
        "question": "Which car company makes the Thunderbird?",
        "right": "Ford",
        "wrong1": "Toyota",
        "wrong2": "Cadillac",
        "wrong3": "Chevy",
    },
    {
        "question": "When introduced in 1954, Peanut M&Ms were only available in what color?",
        "right": "Brown",
        "wrong1": "Red",
        "wrong2": "White",
        "wrong3": "Yellow",
    },
    {
        "question": "The city of Milwaukee, Wisconsin is located on which of the great Lakes?",
        "right": "Lake Michigan",
        "wrong1": "Lake Erie",
        "wrong2": "Lake Huron",
        "wrong3": "Lake Superior",
    },
    {
        "question": "In what year did the United States celebrate its bicentennial?",
        "right": "1976",
        "wrong1": "1865",
        "wrong2": "1876",
        "wrong3": "1965",
    },
    {
        "question": "How Many Countries Are There In The 'Arab World'?",
        "right": "22",
        "wrong1": "25",
        "wrong2": "23",
        "wrong3": "26",
    },
    {
        "question": "In What Year Did Beijing Host The Olympic Games?",
        "right": "2008",
        "wrong1": "1996",
        "wrong2": "2000",
        "wrong3": "2012",
    }  
]

let Questionnaire1 = [
    {
        "question": "Question content is in here 0",
        "right": "this is right answer 0",
        "wrong1": "this is wrong aswer 1",
        "wrong2": "this is wrong aswer 2",
        "wrong3": "this is wrong aswer 3",
    },
    {
        "question": "Question content is in here 1",
        "right": "this is right answer 0",
        "wrong1": "this is wrong aswer 1",
        "wrong2": "this is wrong aswer 2",
        "wrong3": "this is wrong aswer 3",
    },
    {
        "question": "Question content is in here 2",
        "right": "this is right answer 0",
        "wrong1": "this is wrong aswer 1",
        "wrong2": "this is wrong aswer 2",
        "wrong3": "this is wrong aswer 3",
    }
]

let UsedQuestions = []

const MoneyTree = [0,1000,5000,10000,50000,75000,125000,250000,500000]
let currentMoney = 0
let bank = 0

let questionNumber = 1 //To identyfy number of question the player answered
let currentQuestion

let counter = 120 //amount of count down seconds
let timer

let countDownElement = $("#countdown")

let player
let securityCheck = 0
if (localStorage.hasOwnProperty("PLAYER")) {
    player = JSON.parse(localStorage.getItem("PLAYER"))
    console.log(player)
    if (player.hasOwnProperty("banked") == false) {
        securityCheck = 1
    }
    else {
        alert("Cheating FOUND, restarting the game");
        localStorage.removeItem("PLAYER")
    }    
}
else {
    alert("You MUST input player name before playing this game");
}

$(document).ready(function () {
    if (securityCheck == 1) {
        timer = setInterval(countdown, 1000)
        $("div.inner h3").text("Welcome: "+player.name)
        currentQuestion = pickQuestion()
        console.log("Picked: " + currentQuestion)
        displayQuestion(currentQuestion)  
    }
    else { //Prevent player from surpassing the welcome page
        $("#answers .button").addClass("disabled");
        window.location.href = "./Welcomepage.html"
    }    
})

//Click event listener on answers
$("#answers .button").click(function(e){    
    let choice
    let targeted = e.currentTarget
    if (targeted.classList.contains("button") && targeted.classList.contains("disabled")==false) {//If player clicked on the answers
        //console.log("Clicked on the button")
        choice = $(this).children(".answer").text()
        console.log("Player chose: "+choice)
        if (Questionnaire[currentQuestion].right === choice && counter > 0) {//when player's answer is correct and within the time frame
            console.log("You are right!")
            currentMoney += 1
            if (currentMoney ==8) {
                alert("You have reached $500,000 in Money Tree\nGo BANK to start next round\nIf not, you will lose all money")
            }

            let check = confirm("Congratulation!!"+
                "\nYou reached $" + MoneyTree[currentMoney] +
                "\nWould you like to BANK or NOT?")
            if (check) { //If user BANK, add to bank pot, reset moneytree
                bank += MoneyTree[currentMoney]             
                currentMoney = 0
                if (bank >= 500000) { //if user bank pot reach 500,000 then go to next round
                    $("#answers .button").addClass("disabled") //disable all buttons
                    alert("You have reached $500,000 in bank pot. Let's go to final round")

                    player.banked = 500000 //max amoun of money player can win
                    localStorage.setItem("PLAYER", JSON.stringify(player)) 

                    window.location.href = "./roundfinal.html"
                }
                displayCurrentMoney(currentMoney) //update current money
            }
            else {
                if (currentMoney > 8) { //if user doesnt BANK when reach top of MoneyTree, money will be reset
                    currentMoney = 0
                }
                displayCurrentMoney(currentMoney) //update current money             
            }
        }
        else { //when the answer is incorrect
            console.log("You are wrong!")
            alert("Wrong answer!!\nYou are back to $0 on money tree now!")
            currentMoney = 0
            displayCurrentMoney(currentMoney) //update current money
            
        }
        $("#bankPot").text("You are having $"+bank+" in the bank")
        //Change question after answered
        console.log("User keeping: $" + bank + " in bank pot")
        currentQuestion = pickQuestion()
        console.log("Picked: " + currentQuestion)
        displayQuestion(currentQuestion)
    }
})


const displayCurrentMoney = (current) => {   
    let number = MoneyTree.length - 1 - current    
    //remove the highlight node then highlight the current one
    let moneyTreeElements = $(".moneytree")
    for (var i = 0; i < moneyTreeElements.length; i++) {
        if ($(".moneytree:eq("+i+") span").hasClass("highlighted")) {
            $(".moneytree:eq(" + i + ") span").removeClass("highlighted")           
        }
    }
    $(".moneytree:eq(" + number + ")").children("span").addClass("highlighted")
}


const displayQuestion = (pickedQuestion) => {
    $("#question").text(questionNumber + ": " + Questionnaire[pickedQuestion].question)
    let arrAnswers = [
        Questionnaire[pickedQuestion].right,
        Questionnaire[pickedQuestion].wrong1,
        Questionnaire[pickedQuestion].wrong2,
        Questionnaire[pickedQuestion].wrong3
    ]

    arrAnswers = shuffleAnswers(arrAnswers) //shuffle the answer before pushing to interface
    //console.log(arrAnswers)
    let interfaces = $(".answer")
    interfaces[0].innerText = arrAnswers[0]
    interfaces[1].innerText = arrAnswers[1]
    interfaces[2].innerText = arrAnswers[2]
    interfaces[3].innerText = arrAnswers[3]
   
    UsedQuestions.push(pickedQuestion)
    questionNumber += 1
    console.log("Next question: "+questionNumber)

}

const shuffleAnswers = (arr) => {
    let j
    let temp
    for (var i = arr.length -1; i >0; i--) {
        j = Math.floor(Math.random() * i)
        temp = arr[i]
        arr[i] = arr[j]
        arr[j] = temp
    }
    return arr
}


//Counting down time
const countdown = () => {
    countDownElement.text(counter)
    console.log(counter)
    
    if (counter == 0) { //stop repeating again when counter reach 0
        clearInterval(timer) 
        setTimeout(function () { //making a delay for the interface have time to update
            if (bank > 0) {//move user to next round when time reach 0 and their bank is not 0
                $("#answers .button").addClass("disabled");
                alert("Time is OVER.\n"+"You have $"+bank+" in bank pot.\nLet's start the final round")
                player.banked = bank //Add banked property to obj then save to localStorage
                localStorage.setItem("PLAYER", JSON.stringify(player)) 
                window.location.href = "./roundfinal.html"
            }
            else {//If user bank pot is 0, then game over, no reason for playing the final round
                $("#answers .button").addClass("disabled");
                localStorage.removeItem("PLAYER")
                alert("Time is OVER.\nYou have no money in BANK\nYou losed")
            }   
        }, 10)
        
    }    
    counter -= 1  
}

//Picking random question in questionaire except the used one
const pickQuestion = () => { 
    let rand
    try {
        rand = Math.floor(Math.random() * Questionnaire.length)
        return isUsed(rand) ? pickQuestion() : rand
    }
    catch (e) {
        $("#answers .button").addClass("disabled"); //disable choices
        clearInterval(timer) //stop counter
        alert("There is no more question in questionnaire\nContact admin for more details")        
        return -1
    }       
}

//Checking if the question is used or not
const isUsed = (rand) => {
    for (var i = 0; i < UsedQuestions.length; i++) {
        if (parseInt(UsedQuestions[i]) == rand) {
            return true
        }
    }
    return false
}